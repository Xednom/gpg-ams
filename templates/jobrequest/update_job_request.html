{% extends 'base.html' %}
{% load templatetagname %}
{% block title %}
GPG System | View Job Request
{% endblock %}
{% block dashboard_notif %}
<div class="row">
  <div class="col-lg-12">
    <h1 class="page-header">
      View Due Diligence work assigned
    </h1>
  </div>
</div>
{% endblock %}
{% block content %}
<br>
<ol class="breadcrumb">
  <li class="breadcrumb-item">
    <a href="{% url 'users:home' %}">Dashboard</a>
  </li>
  <li class="breadcrumb-item active">
    View Job Requests
  </li>
</ol>
<div id="gpg-job-request" v-cloak>
  <div id="content-wrapper">
    <div class="container-fluid">
      <div class="col-lg-12 col-md-12 col-sm-12">
        <div class="panel panel-default">
          <div class="panel-heading">
            Assigned Job requests
          </div>
          <div class="panel-body">
            <table width="100%" class="table table-striped table-bordered table-hover jobRequestTable"
              id="jobRequestTable">
              <thead>
                <tr>
                  <th>Date Requested</th>
                  <th>Category</th>
                  <th>Company Name</th>
                  <th>Job Request Title</th>
                  <th>Project Managers</th>
                  <th>Project Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="15" class="text-center bg-warning" v-if="!jobRequests.length">You can use "Date", "Client
                    Code" or "VA admin support" to search a data to update/delete.</td>
                </tr>
                <tr class="odd gradeX" v-for="job in jobRequests">
                  <td>[[ job.date_requested ]]</td>
                  <td>[[ job.category ]]</td>
                  <td>[[ job.company_name ]]</td>
                  <td>[[ job.job_request_title ]]</td>
                  <td>[[ job.assigned_project_managers ]]</td>
                  <td>[[ job.project_status ]]</td>
                  {% if perms.jobrequest.change_jobrequest %}
                  <td>
                    <!-- Button trigger modal -->
                    <button type="button" class="btn btn-warning fa fa-edit" data-toggle="modal" data-target="#editModal"
                      v-on:click="getJobRequest(job.id)">
                    </button>
                  </td>
                  <!-- <button type="button" class="btn btn-danger fa fa-trash" v-on:click="deleteJobRequest(job.id)"></button></td> -->
                  {% endif %}
                </tr>
              </tbody>
            </table>
            <!-- /.table-responsive -->
          </div>
          <!-- show a specific info based on view -->
          <!-- Modal -->
          <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
            aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title" id="exampleModalLongTitle">Edit Job request information for [[
                    currentJobRequest.company_name ]]</h4>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <form v-on:submit.prevent="updateJobRequest">
                  <div class="modal-body">
                    <div class="panel panel-default">
                      <div class="panel-heading">
                        Job Request Information for [[ currentJobRequest.company_name ]]
                      </div>
                      <div class="panel-body">
                        {% if request.user.position == "VA" %}
                        <h4 class="title1">General Informations</h4>
                        <hr>
                        <div class="row">
                        <form v-on:submit.prevent=updateJobRequest>
                          {% csrf_token %}
                        <div class="form-group col-md-3 col-sm-12">
                          <label>Month</label>
                          <select class="form-control" v-model="currentJobRequest.month">
                            <option>January</option>
                            <option>February</option>
                            <option>March</option>
                            <option>April</option>
                            <option>May</option>
                            <option>June</option>
                            <option>July</option>
                            <option>August</option>
                            <option>September</option>
                            <option>October</option>
                            <option>November</option>
                            <option>December</option>
                          </select>
                        </div>
                        <div class="form-group col-md-3 col-sm-12">
                          <label>Time in</label>
                          <input type="number"
                          class="form-control" 
                          step="0.01"
                          v-model="currentJobRequest.time_in">
                        </div>
                        <div class="form-group col-md-3 col-sm-12">
                          <label>Time in</label>
                          <input type="number"
                          class="form-control" 
                          step="0.01"
                          v-model="currentJobRequest.time_out">
                        </div>
                        <div class="form-group col-md-3 col-sm-12">
                          <label>Total minutes hours</label>
                          <input type="number"
                          class="form-control" 
                          step="0.01"
                          v-model="currentJobRequest.total_minutes_hours">
                        </div>
                      </div>
                      {% endif %}
                      <hr>
                      <h4 class="title1">Job Request Informations</h4>
                      <div class="row">
                            <div class="form-group col-md-4 col-sm-12">
                              <label for="brand_name">Category</label>
                              <input class="form-control" id="brand_name" v-model="currentJobRequest.category" autocomplete="off"
                              {% if request.user.position == 'Client' or request.user.is_superuser %}{% else %}disabled{% endif %} />
                            </div>
                            <div class="form-group col-md-4 col-sm-12">
                              <label>Requestor's Name</label>
                              <input type="text" class="form-control" v-model="currentJobRequest.requestors_name" autocomplete="off"
                              {% if request.user.position == 'Client' or request.user.is_superuser %}{% else %}disabled{% endif %} />
                            </div>
                            <div class="form-group col-md-4 col-sm-12">
                              <label>Company Name</label>
                              <input type="text" class="form-control" v-model="currentJobRequest.company_name" autocomplete="off"
                              {% if request.user.position == 'Client' or request.user.is_superuser %}{% else %}disabled{% endif %} />
                            </div>
                            <div class="form-group col-md-4 col-sm-12">
                              <label>Job Request number</label>
                              <input type="text" class="form-control" v-model="currentJobRequest.job_request_number" autocomplete="off"
                              {% if request.user.position == 'Client' or request.user.is_superuser %}{% else %}disabled{% endif %}>
                            </div>
                            <div class="form-group col-md-4 col-sm-12">
                              <label>Job Request Title</label>
                              <input type="text" class="form-control" v-model="currentJobRequest.job_request_title" autocomplete="off"
                              {% if request.user.position == 'Client' or request.user.is_superuser %}{% else %}disabled{% endif %}>
                            </div>
                            <div class="form-group col-md-12 col-sm-12">
                              <label>Job Request Instructions</label>
                              <textarea cols="15" rows="15" class="form-control" v-model="currentJobRequest.job_request_instruction"
                              {% if request.user.position == 'Client' or request.user.is_superuser %}{% else %}disabled{% endif %}></textarea>
                            </div>
                            <div class="form-group col-md-4 col-sm-12">
                              <label>Assigned Project Manager </label>
                              <select class="form-control" v-model="currentJobRequest.assigned_project_managers"
                              {% if request.user.position == 'Client' or request.user.is_superuser %}{% else %}disabled{% endif %}>
                                <option v-for="pm in projectManagers">[[pm.project_manager]]</option>
                              </select>
                            </div>
                            <div class="form-group col-md-4 col-sm-12">
                              <label>VA admin support</label>
                              <select class="form-control" v-model="currentJobRequest.assigned_va"
                              {% if request.user.position == 'Client' or request.user.is_superuser %}{% else %}disabled{% endif %}>
                                <option v-for="va in virtualAssistants">[[ va.name ]]</option>
                              </select>
                            </div>
                            <div class="form-group col-md-12 col-sm-12">
                              <label>Additional comments or feedbacks</label>
                              <textarea cols="30" rows="10" class="form-control" v-model="currentJobRequest.additional_comments_or_feedbacks"
                              {% if request.user.position == 'Client' or request.user.is_superuser %}{% else %}disabled{% endif %}></textarea>
                            </div>
                            <div class="form-group col-md-12 col-sm-12">
                              <label>Client Notes</label>
                              <textarea cols="30" rows="10" class="form-control"
                                v-model="currentJobRequest.client_notes"
                                {% if request.user.position == 'Client' or request.user.is_superuser %}{% else %}disabled{% endif %}></textarea>
                            </div>
                            <div class="form-group col-md-12 col-sm-12">
                              <label>Manager Notes</label>
                              <textarea cols="30" rows="10" class="form-control"
                                v-model="currentJobRequest.manager_notes"
                                {% if request.user.position == 'Project Manager' or request.user.is_superuser %}{% elif request.user.position == 'Client' or request.user.position == 'VA' %}disabled{% endif %}></textarea>
                            </div>
                            <div class="form-group col-md-12 col-sm-12">
                              <label>VA Notes</label>
                              <textarea cols="30" rows="10" class="form-control"
                                v-model="currentJobRequest.va_notes"
                                {% if request.user.position == 'VA' or request.user.is_superuser %}{% elif request.user.position == 'Client' or request.user.position == 'Project Manager' %}disabled{% endif %}></textarea>
                            </div>
                          </div>
                      </div>
                      <!-- panelbody ends here -->
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-info" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}